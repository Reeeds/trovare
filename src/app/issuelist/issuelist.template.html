<div class="main-header">
    <div class="app-name app-name--header"><i class="icon ion-ionic"></i><span class="main">trovare</span></div>
    <div class="upload-form">
      <label class="btn btn--primary" for="file-upload">Load CSV</label>
      <input type="file" id="file-upload" on-read-file="$ctrl.fileLoaded(fileContent)" accept=".csv" class="file" />
    </div>
    <div class="file-info">
      <i class="icon ion-information-circled"></i>{{ $ctrl.rows.length > 0 ? ('Showing ' + issueResultList.length + ' of ' + $ctrl.rows.length) : 'No issues found' }}
    </div>
    <div class="main-header__control-container gap-before" ng-hide="$ctrl.content == ''">
      <form class="form main-header__control">
        <div class="form__group">
          <input type="text" class="form__input form__input--search" placeholder="Search" ng-model="$ctrl.search" ng-model-options="{debounce: 500}" />
        </div>
      </form>
    </div>
    <div class="main-header__control-container" ng-hide="$ctrl.content == ''">
      <multi-select class="main-header__control" title="Columns" item-list="$ctrl.headers"></multi-select>
    </div>
</div>

<div class="main-container" auto-loader="$ctrl.loadMore()">
  <div class="content-container">
    <table class="table table-striped">
      <thead class="table-headers">
        <tr>
          <th class="table-header" ng-repeat="(columnKey,header) in $ctrl.headers track by columnKey" ng-show="header.active">
            <a class="link" ng-click="$ctrl.sortType = columnKey; $ctrl.sortReverse = !$ctrl.sortReverse; $ctrl.updateFilterName()" title="{{columnKey}}">
              {{::header.title}}
              <span ng-show="$ctrl.sortType == columnKey"
                    ng-class="{ 'ion-arrow-up-b': !$ctrl.sortReverse, 'ion-arrow-down-b': $ctrl.sortReverse }"
                    class="icon icon-right"></span>
            </a>

            <a ng-repeat="subHeader in header.subHeaders"
               ng-click="$ctrl.sortType = subHeader.key; $ctrl.sortReverse = !$ctrl.sortReverse; $ctrl.updateFilterName()"
               ng-class="{ 'even': $even }"
               title="{{subHeader.key}}" class="link sub">
              {{::subHeader.title}}
                <span ng-show="$ctrl.sortType == subHeader.key"
                      ng-class="{ 'ion-arrow-up-b': !$ctrl.sortReverse, 'ion-arrow-down-b': $ctrl.sortReverse }"
                      class="icon icon-right"></span>
            </a>
          </th>
        </tr>
      </thead>

      <tbody class="table-rows">
        <tr ng-repeat="row in $ctrl.rows | multiSearch:$ctrl.search | orderBy:$ctrl.orderBy:$ctrl.sortReverse | limitTo: $ctrl.limitTo as issueResultList track by $index ">
          <td ng-repeat="(key,val) in row track by $index" ng-show="$ctrl.headers[key].active"
              ng-class="{ 'is-unbreakable': ($ctrl.headers[key].singleLine) }">
              <table-field row="row" key="key" val="val" headers="$ctrl.headers" get-search-words="$ctrl.getSearchWords()" auto-copy="$index === 0" />

              <table-field ng-repeat="subHeader in $ctrl.headers[key].subHeaders"
                           row="row" key="subHeader.key" val="row[subHeader.key]" headers="$ctrl.headers" get-search-words="$ctrl.getSearchWords()"
                           ng-class="{ 'even': $even }" class="sub" />
          </td>
        </tr>
      </tbody>
    </table>

    <div class="text-centered">
      <a class="btn btn--primary" ng-click="$ctrl.loadMore()" ng-show="$ctrl.rows.length > $ctrl.limitTo && issueResultList.length === $ctrl.limitTo"><i class="icon ion-refresh"></i>Load more</a>
    </div>
  </div>
</div>

